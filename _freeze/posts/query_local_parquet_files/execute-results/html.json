{
  "hash": "7459bc32f073edf391f5cca716796b8a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Query local parquet files\"\ndate: \"2024-04-04\"\ncategories: [database, parquet, arrow]\n---\n\n\n\nAfter releasing the parquet files with zonal statistics of climate indicators for Brazilian municipalities, I am receiving some inquiries about how to query the files in an efficient way, avoiding loading all data to the memory. This blog post shows some examples about how to do it.\n\nAfter downloading the desired data, load the following packages on R.\n\n## Packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) #<1>\nlibrary(arrow)     #<2>\n```\n:::\n\n\n\n1.  The `{tidyverse}` load several packages like `{dplyr}` that will help us to handle the data.\n2.  The `{arrow}` package present efficient ways to connect to parquet files.\n\n## Access the data\n\n### Small datasets\n\nThe most straightforward way to read a parquet file is with the `read_parquet()` command. But this will load all parquet data to the memory. Use this command only with small parquet files (and remember that parquet files are usually compressed).\n\n### Large datasets\n\nFor large datasets, we can use the `open_dataset()` command. This will create a virtual link to the parquet file but will not load it to the memory.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_mean <- open_dataset(sources = \"~/Downloads/2m_temperature_mean.parquet\")\n\nprint(temp_mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFileSystemDataset with 1 Parquet file\ncode_muni: int64\ndate: date32[day]\nname: string\nvalue: float\n```\n\n\n:::\n:::\n\n\n\nWith the `sources` argument, you can point to a specific parquet file or to a folder with several files. Check the help to learn more about this command `?open_dataset`.\n\nWhen we print the `temp_mean` object, the console shows how many parquet files are linked and the available variables.\n\n#### Dimension\n\nTo check the dimension (number of lines and columns), you can use the `dim()` command.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(temp_mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 742164605         4\n```\n\n\n:::\n:::\n\n\n\nThat is a lot of rows!\n\n#### Print first rows\n\nTo take a look at the file, we can print the first rows.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_mean |>   #<1>\n  head() |>    #<2>\n  collect() |> #<3>\n  gt::gt()     #<4>\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"qwgoawcyyq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#qwgoawcyyq table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#qwgoawcyyq thead, #qwgoawcyyq tbody, #qwgoawcyyq tfoot, #qwgoawcyyq tr, #qwgoawcyyq td, #qwgoawcyyq th {\n  border-style: none;\n}\n\n#qwgoawcyyq p {\n  margin: 0;\n  padding: 0;\n}\n\n#qwgoawcyyq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#qwgoawcyyq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#qwgoawcyyq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#qwgoawcyyq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#qwgoawcyyq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#qwgoawcyyq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#qwgoawcyyq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#qwgoawcyyq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#qwgoawcyyq .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#qwgoawcyyq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#qwgoawcyyq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qwgoawcyyq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#qwgoawcyyq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#qwgoawcyyq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#qwgoawcyyq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwgoawcyyq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#qwgoawcyyq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#qwgoawcyyq .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#qwgoawcyyq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwgoawcyyq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#qwgoawcyyq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwgoawcyyq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#qwgoawcyyq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwgoawcyyq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qwgoawcyyq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwgoawcyyq .gt_left {\n  text-align: left;\n}\n\n#qwgoawcyyq .gt_center {\n  text-align: center;\n}\n\n#qwgoawcyyq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#qwgoawcyyq .gt_font_normal {\n  font-weight: normal;\n}\n\n#qwgoawcyyq .gt_font_bold {\n  font-weight: bold;\n}\n\n#qwgoawcyyq .gt_font_italic {\n  font-style: italic;\n}\n\n#qwgoawcyyq .gt_super {\n  font-size: 65%;\n}\n\n#qwgoawcyyq .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#qwgoawcyyq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#qwgoawcyyq .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#qwgoawcyyq .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#qwgoawcyyq .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#qwgoawcyyq .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#qwgoawcyyq .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"code_muni\">code_muni</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"name\">name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"value\">value</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">1100015</td>\n<td headers=\"date\" class=\"gt_row gt_right\">1950-01-01</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">298.4606</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">1100015</td>\n<td headers=\"date\" class=\"gt_row gt_right\">1950-01-02</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">298.1530</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">1100015</td>\n<td headers=\"date\" class=\"gt_row gt_right\">1950-01-03</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">298.6412</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">1100015</td>\n<td headers=\"date\" class=\"gt_row gt_right\">1950-01-04</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">297.9100</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">1100015</td>\n<td headers=\"date\" class=\"gt_row gt_right\">1950-01-05</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">298.3538</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">1100015</td>\n<td headers=\"date\" class=\"gt_row gt_right\">1950-01-06</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">297.4383</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n1.  The object that points to the parquet file.\n2.  R base command to access the first rows of a data frame. You can use `head(10)` to access more lines if you want.\n3.  Collect the data from the parquet file to the memory.\n4.  Present the result in a nice table.\n\n## Query \n\nNow we are ready to query the data. We can use some `dplyr` verbs to filter the data we want.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres1 <- temp_mean |>\n  filter(code_muni %in% c(3303401, 3136702, 3304557)) |> #<1>\n  filter(year(date) >= 2000) |> #<2>\n  filter(name == \"2m_temperature_mean_mean\") |> #<3>\n  collect() #<4>\n```\n:::\n\n\n\n1.  Filter some municipalities (Nova Friburgo, Juiz de Fora and Rio de Janeiro IBGE codes).\n2.  Filter dates where the year is 2000 or greater.\n3.  Filter the indicator.\n4.  Collect the data from the parquet to memory.\n\nLet's inspect the results.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(res1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 25203     4\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres1 |> head() |> gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"llekhfehmw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#llekhfehmw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#llekhfehmw thead, #llekhfehmw tbody, #llekhfehmw tfoot, #llekhfehmw tr, #llekhfehmw td, #llekhfehmw th {\n  border-style: none;\n}\n\n#llekhfehmw p {\n  margin: 0;\n  padding: 0;\n}\n\n#llekhfehmw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#llekhfehmw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#llekhfehmw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#llekhfehmw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#llekhfehmw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#llekhfehmw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#llekhfehmw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#llekhfehmw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#llekhfehmw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#llekhfehmw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#llekhfehmw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#llekhfehmw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#llekhfehmw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#llekhfehmw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#llekhfehmw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#llekhfehmw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#llekhfehmw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#llekhfehmw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#llekhfehmw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#llekhfehmw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#llekhfehmw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#llekhfehmw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#llekhfehmw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#llekhfehmw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#llekhfehmw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#llekhfehmw .gt_left {\n  text-align: left;\n}\n\n#llekhfehmw .gt_center {\n  text-align: center;\n}\n\n#llekhfehmw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#llekhfehmw .gt_font_normal {\n  font-weight: normal;\n}\n\n#llekhfehmw .gt_font_bold {\n  font-weight: bold;\n}\n\n#llekhfehmw .gt_font_italic {\n  font-style: italic;\n}\n\n#llekhfehmw .gt_super {\n  font-size: 65%;\n}\n\n#llekhfehmw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#llekhfehmw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#llekhfehmw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#llekhfehmw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#llekhfehmw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#llekhfehmw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#llekhfehmw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"code_muni\">code_muni</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"name\">name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"value\">value</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2000-01-01</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">294.2239</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2000-01-02</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">293.3698</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2000-01-03</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">293.7604</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2000-01-04</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">295.7519</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2000-01-05</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">296.5222</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2000-01-06</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">296.7838</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nAs you can see, the command `collect()` does all the magic. Filters and other verbs are translated and executed with the file on disk and only the results are returned.\n\nWe can also make some aggregations before loading the data into memory. By example, let's convert this data from daily to weekly.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres2 <- temp_mean |>\n  filter(code_muni %in% c(3303401, 3136702, 3304557)) |>\n  filter(year(date) >= 2000) |>\n  filter(name == \"2m_temperature_mean_mean\") |>\n  mutate(date_w = ceiling_date(date, unit = \"week\")) |> #<1>\n  group_by(code_muni, date_w, name) |> #<2>\n  summarise(value = mean(value, na.rm = TRUE)) |> #<3>\n  ungroup() |> #<4>\n  collect() #<5>\n```\n:::\n\n\n\n1.  First, we create a date variable with the first date of the week. Take a look on `?ceiling_date` to learn more about this function.\n2.  Now we will group or data by municipality code, week start date and indicator name.\n3.  Summarize value by the mean of values.\n4.  Ungroup the data.\n5.  Collect the data from the parquet file to memory.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(res2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3603    4\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres2 |> head() |> gt::gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"exjpjqgbqk\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#exjpjqgbqk table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#exjpjqgbqk thead, #exjpjqgbqk tbody, #exjpjqgbqk tfoot, #exjpjqgbqk tr, #exjpjqgbqk td, #exjpjqgbqk th {\n  border-style: none;\n}\n\n#exjpjqgbqk p {\n  margin: 0;\n  padding: 0;\n}\n\n#exjpjqgbqk .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#exjpjqgbqk .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#exjpjqgbqk .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#exjpjqgbqk .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#exjpjqgbqk .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#exjpjqgbqk .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#exjpjqgbqk .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#exjpjqgbqk .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#exjpjqgbqk .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#exjpjqgbqk .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#exjpjqgbqk .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#exjpjqgbqk .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#exjpjqgbqk .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#exjpjqgbqk .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#exjpjqgbqk .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#exjpjqgbqk .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#exjpjqgbqk .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#exjpjqgbqk .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#exjpjqgbqk .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#exjpjqgbqk .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#exjpjqgbqk .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#exjpjqgbqk .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#exjpjqgbqk .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#exjpjqgbqk .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#exjpjqgbqk .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#exjpjqgbqk .gt_left {\n  text-align: left;\n}\n\n#exjpjqgbqk .gt_center {\n  text-align: center;\n}\n\n#exjpjqgbqk .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#exjpjqgbqk .gt_font_normal {\n  font-weight: normal;\n}\n\n#exjpjqgbqk .gt_font_bold {\n  font-weight: bold;\n}\n\n#exjpjqgbqk .gt_font_italic {\n  font-style: italic;\n}\n\n#exjpjqgbqk .gt_super {\n  font-size: 65%;\n}\n\n#exjpjqgbqk .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#exjpjqgbqk .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#exjpjqgbqk .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#exjpjqgbqk .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#exjpjqgbqk .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#exjpjqgbqk .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#exjpjqgbqk .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"code_muni\">code_muni</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date_w\">date_w</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"name\">name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"value\">value</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date_w\" class=\"gt_row gt_right\">2000-01-02</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">294.2239</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date_w\" class=\"gt_row gt_right\">2000-01-09</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">295.3651</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date_w\" class=\"gt_row gt_right\">2000-01-16</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">296.8024</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date_w\" class=\"gt_row gt_right\">2000-01-23</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">295.6669</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date_w\" class=\"gt_row gt_right\">2000-01-30</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">293.7877</td></tr>\n    <tr><td headers=\"code_muni\" class=\"gt_row gt_right\">3136702</td>\n<td headers=\"date_w\" class=\"gt_row gt_right\">2000-02-06</td>\n<td headers=\"name\" class=\"gt_row gt_left\">2m_temperature_mean_mean</td>\n<td headers=\"value\" class=\"gt_row gt_right\">295.9360</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nAnd a simple plot.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = res2, aes(x = date_w, y = value, group = code_muni, color = as.character(code_muni))) +\n  geom_line(stat = \"identity\", alpha = .5) +\n  theme_bw() +\n  theme(legend.position = \"bottom\", legend.direction = \"horizontal\") +\n  labs(title = \"Average temperature\", color = \"Municipality\",\n       x = \"Week start\", y = \"Temp (k)\")\n```\n\n::: {.cell-output-display}\n![](query_local_parquet_files_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n## Bonus: indicator meaning\n\nWhat the indicator **2m_temperature_mean_mean** means?\n\n-   `2m_temperature` is the base indicator, it is the atmospheric temperature at 2m height.\n\n-   `_mean` (the first mean): we are using the average temperature of the day. It could be the maximum (`max`) or minimum (`min`) for example.\n\n-   `_mean` (the second mean): we are dealing with zonal statistics. This is the zonal statistic that was applied on all spatial cells that intersects the municipality. We also have the `max`, `min`, `sd` (standard deviation) and `count` (cells count). For volume indicators there is also the `sum`.\n\nUsually, for temperature we will use the `mean`, and for precipitation the `sum`.\n\n## Session info\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.3.3 (2024-02-29)\n os       Ubuntu 22.04.4 LTS\n system   x86_64, linux-gnu\n ui       X11\n language en_US:en\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       Europe/Paris\n date     2024-04-04\n pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n arrow       * 15.0.1  2024-03-12 [1] CRAN (R 4.3.3)\n assertthat    0.2.1   2019-03-21 [1] CRAN (R 4.3.1)\n bit           4.0.5   2022-11-15 [1] CRAN (R 4.3.1)\n bit64         4.0.5   2020-08-30 [1] CRAN (R 4.3.1)\n cli           3.6.2   2023-12-11 [1] CRAN (R 4.3.2)\n colorspace    2.1-0   2023-01-23 [1] CRAN (R 4.3.1)\n digest        0.6.35  2024-03-11 [1] CRAN (R 4.3.3)\n dplyr       * 1.1.4   2023-11-17 [1] CRAN (R 4.3.2)\n evaluate      0.23    2023-11-01 [1] CRAN (R 4.3.1)\n fansi         1.0.6   2023-12-08 [1] CRAN (R 4.3.2)\n farver        2.1.1   2022-07-06 [1] CRAN (R 4.3.1)\n fastmap       1.1.1   2023-02-24 [1] CRAN (R 4.3.1)\n forcats     * 1.0.0   2023-01-29 [1] CRAN (R 4.3.1)\n generics      0.1.3   2022-07-05 [1] CRAN (R 4.3.1)\n ggplot2     * 3.5.0   2024-02-23 [1] CRAN (R 4.3.2)\n glue          1.7.0   2024-01-09 [1] CRAN (R 4.3.2)\n gt            0.10.1  2024-01-17 [1] CRAN (R 4.3.2)\n gtable        0.3.4   2023-08-21 [1] CRAN (R 4.3.1)\n hms           1.1.3   2023-03-21 [1] CRAN (R 4.3.1)\n htmltools     0.5.8.1 2024-04-04 [1] CRAN (R 4.3.3)\n htmlwidgets   1.6.4   2023-12-06 [1] CRAN (R 4.3.2)\n jsonlite      1.8.8   2023-12-04 [1] CRAN (R 4.3.2)\n knitr         1.45    2023-10-30 [1] CRAN (R 4.3.1)\n labeling      0.4.3   2023-08-29 [1] CRAN (R 4.3.1)\n lifecycle     1.0.4   2023-11-07 [1] CRAN (R 4.3.2)\n lubridate   * 1.9.3   2023-09-27 [1] CRAN (R 4.3.1)\n magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.3.1)\n munsell       0.5.1   2024-04-01 [1] CRAN (R 4.3.3)\n pillar        1.9.0   2023-03-22 [1] CRAN (R 4.3.1)\n pkgconfig     2.0.3   2019-09-22 [1] CRAN (R 4.3.1)\n purrr       * 1.0.2   2023-08-10 [1] CRAN (R 4.3.1)\n R6            2.5.1   2021-08-19 [1] CRAN (R 4.3.1)\n readr       * 2.1.5   2024-01-10 [1] CRAN (R 4.3.2)\n rlang         1.1.3   2024-01-10 [1] CRAN (R 4.3.2)\n rmarkdown     2.26    2024-03-05 [1] CRAN (R 4.3.3)\n rstudioapi    0.16.0  2024-03-24 [1] CRAN (R 4.3.3)\n sass          0.4.9   2024-03-15 [1] CRAN (R 4.3.3)\n scales        1.3.0   2023-11-28 [1] CRAN (R 4.3.2)\n sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.3.1)\n stringi       1.8.3   2023-12-11 [1] CRAN (R 4.3.2)\n stringr     * 1.5.1   2023-11-14 [1] CRAN (R 4.3.2)\n tibble      * 3.2.1   2023-03-20 [1] CRAN (R 4.3.1)\n tidyr       * 1.3.1   2024-01-24 [1] CRAN (R 4.3.2)\n tidyselect    1.2.1   2024-03-11 [1] CRAN (R 4.3.3)\n tidyverse   * 2.0.0   2023-02-22 [1] CRAN (R 4.3.1)\n timechange    0.3.0   2024-01-18 [1] CRAN (R 4.3.2)\n tzdb          0.4.0   2023-05-12 [1] CRAN (R 4.3.1)\n utf8          1.2.4   2023-10-22 [1] CRAN (R 4.3.1)\n vctrs         0.6.5   2023-12-01 [1] CRAN (R 4.3.2)\n withr         3.0.0   2024-01-16 [1] CRAN (R 4.3.2)\n xfun          0.43    2024-03-25 [1] CRAN (R 4.3.3)\n xml2          1.3.6   2023-12-04 [1] CRAN (R 4.3.2)\n yaml          2.3.8   2023-12-11 [1] CRAN (R 4.3.2)\n\n [1] /home/raphael/R/x86_64-pc-linux-gnu-library/4.3\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n",
    "supporting": [
      "query_local_parquet_files_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}