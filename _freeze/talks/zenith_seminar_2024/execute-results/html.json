{
  "hash": "e61ca52acdd837f014a6a63815943033",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Disease and climate data fusion for modeling\"\nsubtitle: \"An application case for Brazil\"\nauthor: \"Raphael Saldanha\"\ninstitute: \"Inria\"\ndate: \"2024-03-20\"\ndescription: \"Talk at the Inria Zenith's Team Seminar.\"\ncategories: [brclim]\nimage: images/prec_map_1.png\nformat:\n  revealjs: \n    theme: inria_style.scss\n    logo: inria_logo.png\n    transition: fade\n    background-transition: fade\n    pointer:\n      pointerSize: 40\n      color: '#e63312'\ncode-link: true\nrevealjs-plugins:\n  - pointer\n---\n\n\n\n## Introduction\n\n-   Postdoctoral researcher at **Inria**, Zenith team\n-   Master's at Public Health, Doctorate on Health Information\n-   Data Science applied to Public Health\n\n## Climate sensitive diseases\n\n-   **Direct** relationship: floods, droughts, heat waves...\n\n-   **Indirect** relationship\n\n\n\n```{mermaid}\n%%{\n  init: {\n    'theme': 'base',\n    'themeVariables': {\n      'fontSize': '30px'\n    }\n  }\n}%%\nflowchart LR\n\nclimate(Climate) --> vector(Disease vectors) --> health(Human health)\nclimate --> health\nclimate --> social(Social & economic \\n determinants) --> health\n```\n\n\n\n## A time-lagged relationship\n\n::: columns\n::: {.column width=\"45%\"}\n-   Vector life cycle from a time perspective\n-   Climate conditions from the **past** leads to the disease incidence of **tomorrow**\n:::\n\n::: {.column width=\"55%\"}\n![](images/aedes_cycle.png){fig-align=\"center\"}\n:::\n:::\n\n## Climate data\n\n::: columns\n::: {.column width=\"45%\"}\n-   Data sources\n    -   In situ: Weather stations, rain gauges\n    -   Remote: Satellites, drones\n-   Data products\n    -   Statistical surface interpolations\n    -   Model reanalysis\n:::\n\n::: {.column width=\"10%\"}\n:::\n\n::: {.column width=\"15%\"}\n\n\n{{< fa sun size=2xl >}} \n\n\n\n<br></br> \n\n\n{{< fa cloud-rain size=2xl >}} \n\n\n\n<br></br> \n\n\n{{< fa wind size=2xl >}} \n\n\n\n<br></br> \n\n\n{{< fa snowflake size=2xl >}}\n\n\n\n:::\n\n::: {.column width=\"15%\"}\n<br></br> \n<br></br>\n\n\n{{< fa satellite size=2xl >}}\n\n\n\n<br></br> \n\n\n{{< fa tower-cell size=2xl >}}\n\n\n\n:::\n\n::: {.column width=\"15%\"}\n<br></br> \n<br></br> \n\n\n{{< fa layer-group size=2xl >}} \n\n\n\n<br></br> \n\n\n{{< fa table-cells size=2xl >}}\n\n\n\n:::\n:::\n\n## ERA5-Land reanalysis\n\n::: columns\n::: {.column width=\"40%\"}\n-   Copernicus, ECMWF\n-   Global coverage\n-   Hourly data\n-   1950 to the present (one week delay)\n-   Spatial resolution \\~9km\n-   Several climate indicators\n:::\n\n::: {.column width=\"60%\"}\n![](images/NL161-Sabater-Fig1.jpg){fig-align=\"center\"}\n:::\n:::\n\n## Data structures\n\n-   Climate indicators: grid data\n-   Disease incidence: tabular, individual cases aggregated by spatial regions and time spans\n\n::: columns\n::: {.column width=\"50%\"}\n![](images/temp.png){width=\"80%\"}\n:::\n\n::: {.column width=\"50%\"}\n![](images/admin.png){width=\"80%\"}\n:::\n:::\n\n## Fusioning data\n\n![](images/zonal_statistics.png)\n\n## Case example\n\n**Zonal Statistics of Climate Indicators from ERA5-Land for Brazilian Municipalities**\n\n-   **8 climate indicators**: maximum, minimum and average temperature, total precipitation, surface pressure, dewpoint, $u$ and $v$ components of wind\n-   **6 zonal statistics** computation for the 5,570 Brazilian municipalities\n    -   Minimum, maximum, average, sum, standard deviation, cell count\n-   **Time coverage**: 1950-2022, daily data\n\n## Workflow\n\n\n\n```{mermaid}\n%%{\n  init: {\n    'theme': 'base',\n    'themeVariables': {\n      'fontSize': '30px'\n    }\n  }\n}%%\nflowchart TD\n\nera5(ERA5-Land \\n indicators) --> hdata(Hourly data)\nbb(Latin America \\n bounding box) --> hdata\n\nhdata --> agg(Aggregation to \\n daily data)\n\nagg --> mun(Municipal boundaries)\nmun --> zs(Zonal statistics)\n```\n\n\n\n## ERA5-Land Daily datasets\n\n::: columns\n::: {.column width=\"50%\"}\n-   Open data, available at Zenodo\n-   7,105 files, 658.7 GB\n-   Reproducible R scripts\n-   Plans to continuously update this dataset and add more indicators\n:::\n\n::: {.column width=\"50%\"}\n![](images/era5-land-daily-aggregates.png){fig-align=\"center\"}\n:::\n:::\n\n<https://rfsaldanha.github.io/data-projects/era5land-daily-latin-america.html>\n\n## Zonal statistics {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n-   Challenges to handle the **amount of data** and **computational tasks**\n-   Strategy\n    -   Group the tasks into **chunks** and compute in **parallel**\n    -   DAG (Directed-Acyclic Graph) approach to **orchestrate computation**, with the [{targets}](https://docs.ropensci.org/targets/) package\n    -   Save results into columnar-oriented **databases** for fast data retrieval (duckdb and parquet)    \n:::\n\n::: {.column width=\"50%\"}\n![](images/dag_overview.png){fig-align=\"center\" width=\"70%\"}\n:::\n:::\n\n\n\n##  {.big_text .center data-menu-title=\"Records\" }\n\n::: big_text\n6,085,749,761 records\n:::\n\n## Temperature\n\n::: columns\n::: {.column width=\"50%\"}\n![](images/tmin_map.png){fig-align=\"center\" width=\"70%\"}\n:::\n\n::: {.column width=\"50%\"}\n![](images/tmax_map.png){fig-align=\"center\" width=\"70%\"}\n:::\n:::\n\n## Precipitation {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n![](images/prec_map_2.png){fig-align=\"center\" width=\"100%\"}\n:::\n\n::: {.column width=\"50%\"}\n![](images/prec_map_1.png){fig-align=\"center\" width=\"100%\"}\n:::\n:::\n\nRio de Janeiro municipalities. January 1, 2010.\n\n## Resolution and spatial variability {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n-   Brazilian municipalities size variation\n    -   Altamira (PA): 159,533 km2\n    -   Santa Cruz de Minas (MG): 3 km2\n-   ERA5-Land cell: \\~ 100 km2\n\n![](images/era5_grid_overlay.png){fig-align=\"center\" width=\"80%\"}\n:::\n\n::: {.column width=\"50%\"}\n![](images/count_plot.png){fig-align=\"center\" width=\"100%\"}\n:::\n:::\n\n## Published paper\n\n::: columns\n::: {.column width=\"60%\"}\n-   Environmental Data Science journal\n-   Published on February 8, 2024\n-   Swift submission process\n-   Inria has an [agreement](https://intranet.inria.fr/Actualite/Edition-nouvel-accord-avec-Cambridge-University-Press) for APC fees with the Cambridge University Press\n:::\n\n::: {.column width=\"40%\"}\n[![](https://zenodo.org/badge/DOI/10.1017/eds.2024.3.svg)](https://doi.org/10.1017/eds.2024.3) ![](images/eds_paper.png)\n:::\n:::\n\n## Usage\n\n-   Training multivariate **machine learning models** to forecast dengue incidence in Brazil with a **subsets strategy**\n\n$$\n\\small\n\\begin{aligned}        D_t = \\mu + & \\theta_1 D_{t-1} + \\cdots + \\theta_p D_{t-p} + \\\\        & \\lambda_1 C_{t-1} + \\cdots + \\lambda_p C_{t-p} + \\\\         & \\varepsilon_1 e_{t-1} + \\cdots + \\varepsilon_p e_{t-p}    \\end{aligned}\n$$\n\n-   Accepted paper on **ICDE2024**, Multivariate Time Series Analytics workshop\n\n## Next steps... {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n-   Continuous update\n-   Human settlements, population-weighted zonal statistics\n-   Compute climate time-series features: heat waves, persistent rains, etc.\n-   Adopt climate products with finer resolutions when possible (CHIRPS)\n-   Expand results to other countries\n:::\n\n::: {.column width=\"50%\"}\n![](images/pop_era5_grid_overlay.png){fig-align=\"center\" width=\"100%\"}\n:::\n:::\n\n##  {.big_text .center data-menu-title=\"Thanks\" }\n\n::: big_text\nThanks\n:::\n\n## Backup slides\n\n## Climate reanalysis\n\n<video controls loop preload data-autoplay src=\"https://climate.copernicus.eu/sites/default/files/2020-01/2019.11.21_ECMWF%20Reanalysis%20video_with%20caption_v4_IOB.mp4\">\n\n</video>\n\n## ERA5-Land hourly to daily aggregation\n\n-   Usage of [{KrigR}](https://github.com/ErikKusch/KrigR) package to access the [Copernicus Climate Data Store API](https://cds.climate.copernicus.eu), crop data at server side, download and perform the time aggregation.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload_ERA(Variable = \"2m_temperature\", DataSet = \"era5-land\", \n             DateStart = \"2022-12-01\", DateStop = \"2022-12-31\",\n             TResolution = \"day\", TStep = 1,\n             FUN = \"max\",\n             Extent = extent(c(-118.47,-34.1,-56.65, 33.28)), \n             Dir = \"dir_name\", FileName = \"file_name.nc\", \n             API_User = \"api_user\", API_Key = \"api_key\")\n```\n:::\n\n\n\n-   Took \\~15 days to download and process the data from 8 climate indicators covering the Latin America region\n\n## Computation\n\n-   Zonal statistics weighted by the fraction of the cell that is covered, with the [{exactextractr}](https://isciences.gitlab.io/exactextractr/) package\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexact_extract(\n  x = rst,\n  y = pol,\n  fun = \"mean\"\n)\n```\n:::\n\n\n\n## Results {.smaller}\n\n| ERA5-Land indicators  | Daily time-aggregating functions | Spatial zonal statistics    |\n|----------------------|----------------------------|----------------------|\n| Temperature (2m)      | mean, max, min                   | max, min, stdev, count      |\n| Dewpoint temp. (2m)   | mean                             | max, min, stdev, count      |\n| $u$ component of wind | mean                             | max, min, stdev, count      |\n| $v$ component of wind | mean                             | max, min, stdev, count      |\n| Surface pressure      | mean                             | max, min, stdev, count      |\n| Total precipitation   | sum                              | max, min, stdev, count, sum |\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}